<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>More Than Fitness - Dashboard</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{display:flex;flex-direction:column;height:100vh;font-family:'Poppins',sans-serif;background:#f5f0e8;overflow:hidden}
    .topbar{position:fixed;top:0;left:0;right:0;height:50px;background:#f5f0e8;display:flex;align-items:center;justify-content:space-between;padding:0 15px;box-shadow:0 2px 4px rgba(0,0,0,0.1);z-index:1001}
    .topbar h1{font-size:18px;color:#0d1b2a}
    .hamburger,.logout-btn{background:none;border:none;cursor:pointer;font-size:20px;color:#0d1b2a}
    .sidebar{position:fixed;top:50px;left:0;bottom:0;width:180px;background:#0d1b2a;color:#fff;padding:15px;transform:translateX(-100%);transition:transform .3s ease;z-index:1002}
    .sidebar.active{transform:translateX(0)}
    .sidebar button{background:none;border:none;color:#fff;width:100%;text-align:left;margin:8px 0;cursor:pointer;font-size:14px}
    .main{margin-top:50px;flex:1;overflow-y:auto;padding:8px}
    @media(min-width:769px){.main{margin-left:180px}}
    .today-lessons{background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:8px}
    .today-lessons h2{font-size:16px;color:#0d1b2a;margin-bottom:4px}
    .section-title{margin:8px 0 4px;font-size:14px;color:#0d1b2a}
    .schedule-wrapper{background:#fff;padding:8px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:16px;overflow-x:auto}
    table{width:100%;min-width:600px;border-collapse:collapse;font-size:12px}
    th,td{border:1px solid #ccc;padding:4px;text-align:center;position:relative}
    th{background:#0d1b2a;color:#fff}
    th:first-child{background:#0d3b5a;cursor:pointer}
    .time-cell{background:#f1f1f1;cursor:pointer}
    .current-time-line{position:absolute;left:0;right:0;height:2px;background:#FF3B30;animation:pulse 5s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:0.4}50%{opacity:1}}
    .overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1000}
    .popup{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:16px;border-radius:6px;z-index:1001;width:260px;max-width:90%;max-height:80vh;overflow-y:auto}
    .button-group{display:flex;justify-content:space-between;margin-top:8px}
    .button-group button{width:48%;padding:6px;background:#f5f0e8;border:none;border-radius:4px;cursor:pointer}
    .bottom-nav{display:flex;position:fixed;bottom:0;left:0;right:0;background:#0d1b2a;justify-content:space-around;padding:8px 0}
    .bottom-nav button{background:none;border:none;color:#fff;font-size:14px;cursor:pointer}
    .main{padding-bottom:60px}
  </style>
</head>
<body>
  <div class="topbar">
    <button class="hamburger" id="hamburger">☰</button>
    <h1>More Than Fitness</h1>
    <button class="logout-btn" id="btnLogout">로그아웃</button>
  </div>
  <div class="sidebar" id="sidebar">
    <button class="nav-btn">내 정보 관리</button>
    <button class="nav-btn">회원 관리</button>
    <button class="nav-btn">스케줄 관리</button>
    <button class="nav-btn">기록 관리</button>
    <button class="nav-btn">상품 구매</button>
  </div>
  <div class="main">
    <div class="today-lessons">
      <h2>오늘 다음 레슨</h2>
      <ul id="todayLessonList"></ul>
    </div>
    <div class="section-title" contenteditable>이번 주 스케줄</div>
    <div class="schedule-wrapper">
      <table id="scheduleTableCurr">
        <thead>
          <tr><th id="headerCurr">시간</th><th>월</th><th>화</th><th>수</th>
              <th>목</th><th>금</th><th>토</th><th>일</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="section-title">다음 주 스케줄</div>
    <div class="schedule-wrapper">
      <table id="scheduleTableNext">
        <thead><tr><th>시간</th><th>월</th><th>화</th><th>수</th>
                 <th>목</th><th>금</th><th>토</th><th>일</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="section-title">지난 주 스케줄</div>
    <div class="schedule-wrapper">
      <table id="scheduleTableLast">
        <thead><tr><th>시간</th><th>월</th><th>화</th><th>수</th>
                 <th>목</th><th>금</th><th>토</th><th>일</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <!-- 전체 시간 범위 설정 팝업 -->
  <div class="popup" id="popupRange">
    <h3>시간 범위 설정</h3>
    <label>시작: <input type="time" id="rangeStart" value="06:00"></label><br>
    <label>종료: <input type="time" id="rangeEnd"   value="22:00"></label>
    <div class="button-group">
      <button onclick="applyRangeCurr()">적용</button>
      <button onclick="closePopup()">취소</button>
    </div>
  </div>

  <!-- 분 단위 설정 팝업 -->
  <div class="popup" id="popupMinute">
    <h3>분 단위 설정</h3>
    <select id="minuteSelect">
      <option>00</option><option>10</option><option>20</option>
      <option>30</option><option>40</option><option>50</option>
    </select>
    <div class="button-group">
      <button onclick="saveMinute()">저장</button>
      <button onclick="closePopup()">취소</button>
    </div>
  </div>

  <!-- 레슨 입력 팝업 -->
  <div class="popup" id="popupLesson">
    <h3>레슨 정보</h3>
    <input id="nameInput" placeholder="이름" style="width:100%;margin:8px 0;padding:6px" />
    <input id="enrolledInput" type="number" placeholder="회차" style="width:48%" />
    <input id="capacityInput" type="number" placeholder="총" style="width:48%" />
    <div class="button-group">
      <button onclick="saveLesson()">저장</button>
      <button onclick="deleteLesson()">삭제</button>
    </div>
  </div>

  <script>
    let currentCell = null, scheduleStart = 6, scheduleEnd = 22;
    const overlay = document.getElementById('overlay');

    document.getElementById('hamburger').onclick = () => {
      document.getElementById('sidebar').classList.toggle('active');
      overlay.style.display = document.getElementById('sidebar').classList.contains('active') ? 'block' : 'none';
    };
    overlay.onclick = () => { document.getElementById('sidebar').classList.remove('active'); closePopup(); };
    document.getElementById('btnLogout').onclick = () => {
      alert('로그아웃되었습니다!'); location.href = '/login.html';
    };

    document.addEventListener('DOMContentLoaded', init);
    function init(){
      buildCurr(); buildNext(); buildLast();
      loadCurr(); highlightToday(); updateToday();
      initTimeLine(); setInterval(updateTimeLine,60000);
      document.getElementById('headerCurr').onclick = openRangePopup;
    }

    // --- 이번 주 테이블 생성 (수정된 부분) ---
    function buildCurr(){
      const tb = document.querySelector('#scheduleTableCurr tbody');
      tb.innerHTML = '';
      for(let h=scheduleStart; h<scheduleEnd; h++){
        const r = document.createElement('tr');
        const c0 = document.createElement('td');
        c0.textContent = `${h}:00`;
        c0.className   = 'time-cell';
        c0.onclick     = () => openMinute(c0);   // ← 원래 숫자칸은 분 팝업
        r.append(c0);
        for(let i=0;i<7;i++){
          const c = document.createElement('td');
          c.onclick = () => openLesson(c);
          r.append(c);
        }
        tb.append(r);
      }
    }

    function buildNext(){ /* 동일 */ }
    function buildLast(){ /* 동일 */ }

    function openRangePopup(){
      document.getElementById('popupRange').style.display='block';
      overlay.style.display='block';
    }
    function applyRangeCurr(){
      const s = +document.getElementById('rangeStart').value.split(':')[0];
      const e = +document.getElementById('rangeEnd').value.split(':')[0];
      scheduleStart = s; scheduleEnd = e;
      buildCurr(); buildNext(); buildLast();
      loadCurr(); highlightToday(); updateToday(); initTimeLine();
      closePopup();
    }

    function openMinute(cell){
      currentCell = cell;
      document.getElementById('popupMinute').style.display='block';
      overlay.style.display='block';
    }
    function saveMinute(){
      const m = document.getElementById('minuteSelect').value;
      const h = currentCell.textContent.split(':')[0];
      currentCell.textContent = `${h}:${m}`;
      updateTimeLine(); closePopup();
    }

    function openLesson(c){ /* 동일 */ }
    function saveLesson(){ /* 동일 */ }
    function deleteLesson(){ /* 동일 */ }
    function closePopup(){
      document.querySelectorAll('.popup').forEach(p=>p.style.display='none');
      overlay.style.display='none';
    }

    function loadCurr(){ /* 동일 */ }
    function updateToday(){ /* 동일 */ }
    function initTimeLine(){ updateTimeLine(); }
    function updateTimeLine(){ /* 동일 */ }
    function highlightToday(){ /* 동일 */ }
  </script>
</body>
</html>
