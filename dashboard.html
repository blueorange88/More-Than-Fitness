<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>More Than Fitness - Dashboard</title>
  <style>
    /* ... 기존 CSS 그대로 ... */
  </style>
</head>
<body>
  <div class="topbar">
    <button class="hamburger" id="hamburger">☰</button>
    <h1>More Than Fitness</h1>
    <button class="logout-btn" id="btnLogout">로그아웃</button>
  </div>
  <div class="sidebar" id="sidebar">
    <!-- 사이드바 버튼들 -->
  </div>
  <div class="main">
    <div class="today-lessons">
      <h2>오늘 다음 레슨</h2>
      <ul id="todayLessonList"></ul>
    </div>

    <div class="section-title" contenteditable>이번 주 스케줄</div>
    <div class="schedule-wrapper">
      <table id="scheduleTableCurr">
        <thead>
          <tr>
            <th id="headerCurr">시간</th>
            <th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th><th>일</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- 다음 주, 지난 주 스케줄 테이블들 -->
  </div>

  <div class="overlay" id="overlay"></div>

  <!-- 전체 범위 설정 팝업 -->
  <div class="popup" id="popupRange">
    <h3>시간 범위 설정</h3>
    <label>시작: <input type="time" id="rangeStart" value="06:00"></label><br>
    <label>종료: <input type="time" id="rangeEnd"   value="12:00"></label>
    <div class="button-group">
      <button onclick="applyRangeCurr()">적용</button>
      <button onclick="closePopup()">취소</button>
    </div>
  </div>

  <!-- 분 선택 팝업 -->
  <div class="popup" id="popupMinute">
    <h3>분 단위 설정</h3>
    <select id="minuteSelect">
      <option>00</option><option>10</option><option>20</option>
      <option>30</option><option>40</option><option>50</option>
    </select>
    <div class="button-group">
      <button onclick="saveMinute()">저장</button>
      <button onclick="closePopup()">취소</button>
    </div>
  </div>

  <!-- 레슨 정보 팝업 -->
  <div class="popup" id="popupLesson">
    <!-- ... -->
  </div>

  <script>
    let currentCell = null,
        scheduleStart = 6,
        scheduleEnd   = 22;
    const overlay = document.getElementById('overlay');

    function init() {
      buildCurr();
      buildNext();
      buildLast();
      loadCurr();
      highlightToday();
      updateToday();
      initTimeLine();
      setInterval(updateTimeLine, 60000);
    }

    // 1) 이번 주 테이블 생성
    function buildCurr() {
      const tb = document.querySelector('#scheduleTableCurr tbody');
      tb.innerHTML = '';
      for (let h = scheduleStart; h < scheduleEnd; h++) {
        const r = document.createElement('tr');
        const c0 = document.createElement('td');
        c0.textContent = `${h}:00`;
        c0.className = 'time-cell';
        c0.onclick = () => openMinute(c0);
        r.append(c0);
        for (let i = 0; i < 7; i++) {
          const c = document.createElement('td');
          c.onclick = () => openLesson(c);
          r.append(c);
        }
        tb.append(r);
      }
    }
    // buildNext, buildLast, loadCurr, openMinute, saveMinute, openLesson, saveLesson, deleteLesson,
    // updateToday, initTimeLine, updateTimeLine, highlightToday 등 기존 함수들은 그대로 둡니다.

    // → 여기서부터 팝업 관련 추가 함수

    // 2) 전체 범위 설정 팝업 열기
    function openRangeCurr() {
      currentCell = null;
      document.getElementById('popupRange').style.display = 'block';
      overlay.style.display = 'block';
    }

    // 3) 범위 적용
    function applyRangeCurr() {
      const startH = parseInt(document.getElementById('rangeStart').value.split(':')[0], 10);
      const endH   = parseInt(document.getElementById('rangeEnd').value.split(':')[0],   10);
      scheduleStart = startH;
      scheduleEnd   = endH;
      // 테이블 재생성
      buildCurr();
      loadCurr();
      highlightToday();
      updateToday();
      initTimeLine();
      closePopup();
    }

    // 4) 모든 팝업 닫기
    function closePopup() {
      document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
      overlay.style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', () => {
      init();

      // “시간” 헤더 클릭 시 범위 설정 팝업
      document.getElementById('headerCurr').onclick = openRangeCurr;

      // 로그아웃
      document.getElementById('btnLogout').onclick = () => {
        alert('로그아웃되었습니다!');
        window.location.href = location.origin + '/login.html';
      };
    });
  </script>
</body>
</html>
