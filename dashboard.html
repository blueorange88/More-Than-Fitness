<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>More Than Fitness - Dashboard</title>
  <!-- 스타일 생략 -->
</head>
<body>
  <!-- HTML 구조 생략 -->  <script>
    let currentCell = null;

    function logout() {
      alert('로그아웃되었습니다!');
      window.location.href = '/login.html';
    }

    const tbody = document.querySelector('#scheduleTable tbody');
    for (let h = 6; h <= 22; h++) {
      const row = document.createElement('tr');
      const timeCell = document.createElement('td');
      timeCell.textContent = `${h}:00`;
      timeCell.className = 'time-cell';
      timeCell.onclick = () => openTimePopup(timeCell);
      row.appendChild(timeCell);
      for (let i = 0; i < 7; i++) {
        const cell = document.createElement('td');
        cell.onclick = (e) => openPopup(e);
        row.appendChild(cell);
      }
      tbody.appendChild(row);
    }

    function openTimePopup(cell) {
      currentCell = cell;
      document.getElementById('popupTime').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }

    function openPopup(e) {
      currentCell = e.target;
      const text = currentCell.textContent.trim();
      if (text.includes('19/30')) {
        const parts = text.split(' ');
        if (parts.length >= 2) {
          document.getElementById('nameInput').value = parts[1];
        }
      } else {
        document.getElementById('nameInput').value = '';
      }
      document.getElementById('popup').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }

    function saveMinute() {
      const minute = document.getElementById('minuteSelect').value;
      const hour = currentCell.textContent.split(':')[0];
      currentCell.textContent = `${hour}:${minute}`;
      closePopup();
    }

    function saveLesson() {
      const name = document.getElementById('nameInput').value;
      if (name.trim() !== '') {
        const time = currentCell.parentElement.firstChild.textContent;
        const dayIndex = currentCell.cellIndex;
        const lessonData = { time, dayIndex, content: `${name} 19/30` };
        currentCell.textContent = lessonData.content;
        saveToLocalStorage(lessonData);
      }
      closePopup();
      updateTodayLessons();
    }

    function saveToLocalStorage(lessonData) {
      const saved = JSON.parse(localStorage.getItem('scheduleData')) || [];
      const updated = saved.filter(l => !(l.time === lessonData.time && l.dayIndex === lessonData.dayIndex));
      updated.push(lessonData);
      localStorage.setItem('scheduleData', JSON.stringify(updated));
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
      document.getElementById('popupTime').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    function deleteLesson() {
      if (!currentCell) return;
      const time = currentCell.parentElement.firstChild.textContent;
      const dayIndex = currentCell.cellIndex;
      const saved = JSON.parse(localStorage.getItem('scheduleData')) || [];
      const updated = saved.filter(l => !(l.time === time && l.dayIndex === dayIndex));
      localStorage.setItem('scheduleData', JSON.stringify(updated));
      currentCell.textContent = '';
      closePopup();
      updateTodayLessons();
    }

    function updateTodayLessons() {
      const cells = Array.from(document.querySelectorAll('#scheduleTable td'));
      const lessons = [];
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();

      cells.forEach(cell => {
        const text = cell.textContent.trim();
        cell.style.opacity = '1';

        if (text.includes('19/30')) {
          const parts = text.split(' ');
          if (parts.length >= 2) {
            const timeParts = parts[0].split(':');
            const totalMinutes = parseInt(timeParts[0]) * 60 + parseInt(timeParts[1]);
            if (totalMinutes < currentMinutes) {
              cell.style.opacity = '0.4';
            }
            lessons.push({ time: parts[0], name: parts[1] });
          }
        }
      });

      const upcomingLessons = lessons.map(l => ({
        ...l,
        totalMinutes: parseInt(l.time.split(':')[0]) * 60 + parseInt(l.time.split(':')[1])
      })).filter(l => l.totalMinutes >= currentMinutes)
        .sort((a, b) => a.totalMinutes - b.totalMinutes)
        .slice(0, 2);

      const lessonList = document.getElementById('todayLessonList');
      lessonList.innerHTML = '';
      upcomingLessons.forEach(l => {
        const li = document.createElement('li');
        li.textContent = `${l.time} ${l.name} 19/30`;
        lessonList.appendChild(li);
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      const saved = JSON.parse(localStorage.getItem('scheduleData')) || [];
      saved.forEach(data => {
        const rows = document.querySelectorAll('#scheduleTable tbody tr');
        const row = Array.from(rows).find(r => r.firstChild.textContent === data.time);
        if (row) row.children[data.dayIndex].textContent = data.content;
      });
      updateTodayLessons();
    });

    const today = new Date().getDay();
    const headers = document.querySelectorAll('#scheduleTable th');
    if (headers[today]) {
      headers[today].style.backgroundColor = '#d4af37';
      headers[today].style.color = '#0d1b2a';
    }

    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');
    hamburger.addEventListener('click', () => {
      sidebar.classList.toggle('active');
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePopup();
    });
  </script>
</body>
</html>
